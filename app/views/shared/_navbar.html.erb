<div data-controller="search-overlay">
  <nav class="navbar navbar-expand-md navbar-light navbar-sourcecode">
    <div class="container-fluid d-flex align-items-center">

      <div class="d-md-none pe-2" style="flex: 0 0 auto;">
        <button data-action="click->search-overlay#open"
                class="btn p-0 icon-button" aria-label="Open search">
          <i class="fas fa-search small-icon brand-colored-icon"></i>
        </button>
      </div>

      <%= link_to garments_path, class: "navbar-brand d-flex align-items-center text-decoration-none mx-auto mx-md-0" do %>
        <span class="navbar-brand-name small">
          SOURCECODE<span class="blinking-underscore">_</span>VTG
        </span>
      <% end %>

      <button class="navbar-toggler d-md-none" type="button"
              data-action="click->category-overlay#open"
              aria-label="Toggle categories overlay">
        <span class="navbar-toggler-icon small-toggler"></span>
      </button>

      <div class="cart-container d-md-none d-flex align-items-center ms-2">
        <%= link_to cart_path, class: "d-flex align-items-center text-decoration-none" do %>
          <i class="fas fa-shopping-cart small-icon brand-colored-icon"></i>
        <% end %>
      </div>

      <div class="d-none d-md-flex flex-grow-1 align-items-center justify-content-between gap-3 ms-3">
        <div class="flex-shrink-0"></div>

        <div class="search-container flex-grow-1 mx-3">
          <%= simple_form_for :search, url: garments_path, method: :get do |f| %>
            <div class="search-form-control form-group">
              <input
                class="form-control string required terminal-input"
                autocomplete="off"
                type="text"
                name="search[query]"
                id="search_query"
                data-controller="placeholder"
                data-placeholder-target="input"
                data-action="focus->placeholder#hidePlaceholder blur->placeholder#restorePlaceholder"
                placeholder="> Searching..." />
            </div>
          <% end %>
        </div>

        <div class="d-flex align-items-center gap-3 flex-shrink-0">
          <div class="dropdown-container">
            <form data-controller="category" action="<%= garments_path %>" method="get"
                  class="d-flex align-items-center" data-category-target="form">
              <div class="dropdown">
                <button type="button" class="btn btn-outline-secondary dropdown-toggle">
                  &gt; Categories
                </button>
                <ul class="dropdown-menu">
                  <% @categories.each do |category| %>
                    <li>
                      <button class="dropdown-item" type="button"
                              data-action="click->category#select"
                              data-category-id="<%= category.id %>">
                        &gt; <%= category.name %>
                      </button>
                    </li>
                  <% end %>
                </ul>
                <input data-category-target="hiddenInput" type="hidden" name="category">
              </div>
            </form>
          </div>

          <div data-controller="cart">
            <%= link_to cart_path, class: "cart-container d-flex align-items-center text-decoration-none" do %>
              <i class="fas fa-shopping-cart fs-4 me-1"></i>
              <span class="navbar-cart-text vt323">
                Cart (<span data-cart-target="count" id="cart-count"><%= cart_count %></span>)
              </span>
            <% end %>
          </div>
        </div>
      </div>

    </div>
  </nav>

  <%= render "shared/search_overlay" %>
  <%= render "shared/category_overlay" %>
</div>
